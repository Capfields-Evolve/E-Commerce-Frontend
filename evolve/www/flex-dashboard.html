<!doctype html>
<html lang="en" class="blue-theme">


<!-- Mirrored from maxartkiller.com/website/GoMobileUX/gofruit/signup.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 10 Nov 2019 18:18:22 GMT -->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="Maxartkiller">

    <title>Flex Â· Evolve</title>

    <!-- Material design icons CSS -->
    <link rel="stylesheet" href="vendor/materializeicon/material-icons.css">

    <!-- Roboto fonts CSS -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&amp;display=swap" rel="stylesheet">

    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap-4.3.1/css/bootstrap.min.css" rel="stylesheet">

    <!-- Swiper CSS -->
    <link href="vendor/swiper/css/swiper.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet">
    <style>
        .transfer {
            text-align: center;
            background-color: whitesmoke;
            color: black;
            font-weight: 500;
            padding: 10px;
        }
    </style>
</head>

<body>
    <div class="row no-gutters vh-100 loader-screen">
        <div class="col align-self-center text-white text-center">
            <img src="img/logo.png" height="50px" alt="logo" style="height: 70px">
            <h3><span class="font-weight-light">Capfields</span>Evolve</h3>
            <div class="laoderhorizontal">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
    </div>
    <div class="row no-gutters vh-100 proh bg-template">
        <img src="img/appl.png" alt="logo" class="apple right-image align-self-center">
        <div class="col align-self-center px-3  text-center">
            <!--<img src="img/logo.png" alt="logo" class="logo-small">-->
            <h4 class="text-white"><span class="font-weight-light">Welcome, <span id="flexname"></h4>
                <div><center><img style="height: 200px;" src="img/loan.png"></center></div>
                <p></p>
            <div class="form-group normal">

                <!--flex begins here marve-->
                <center><p style="color: white">Salary <span style="color: pink" id="salary"></p></center>
<br>
                            <center><p style="color: white">Amount Allowed <span style="color: pink" id="allowance"></p></center>
<br>
                            <center><p style="color: white">Amount Used <span style="color: pink" id="used"></p></center><br>
                                <input type="hidden" id="amountused">
                            <center><p style="color: white">Remaining Balance <span style="color: pink" id="flexbal"></p></center><br>
                                <center><p style="color: white">Repayment <span style="color: pink" id="repay"></p></center><br>
                                    <center><p style="color: white">Repayment Date <span style="color: pink" id="repaydate"></p></center>

                <button class="btn btn-lg btn-default text-white btn-block btn-rounded shadow" onclick="checkAmt()"><span>Repay</span><i class="material-icons">arrow_forward</i></button>

        </div>
        <div class="transfer hidden">
            <p style="color:blue">Make transfer to the account details below</p>
            <table class="table table-bordered">
                <tr>
                    <td>Account Number</td>
                    <td>1019049321</td>
                </tr>
                <tr>
                    <td>Account Name</td>
                    <td>Capfields Nig Ltd</td>
                </tr>
                <tr>
                    <td>Bank Name</td>
                    <td>UBA</td>
                </tr>
            </table>
            <form action="" id="uploadimage" method="post" enctype="multipart/form-data">
                <input type="number" id="amounttransfer" class="form-control" style="margin-bottom:5px" disabled>
                <input type="hidden" name="amount" id="tamt">
                <input type="hidden" name="email" id="email">
                <input type="hidden" name="token" id="token">
                <label for="">Upload Payment Receipt</label>
                <input type="file" class="form-control" name="pic" required>
                <button type="submit" id="uploadBtn" class="btn btn-default btn-block btn-rounded shadow" style="margin-top:5px">Submit</button>
            </form>
        </div>
        <div class="cardpayment hidden">
            <div class="row">
                <div class="col-12">
                    <button class="btn btn-success btn-block btn-rounded shadow-sm" onclick="makePayment()">Pay with Flutterwave</button>
                </div>
            </div><br>
            <div class="row">
                <div class="col-12">
                    <button class="btn btn-primary btn-block btn-rounded shadow-sm" onclick="showStack()">Pay with Paystack</button>
                </div>
            </div>
            <div class="paystack hidden">
                <div class="row">
                    <div class="col-12">
                        <div class="form-group">
                            <label for="">Card Number</label>
                            <input type="number" class="form-control" id="cardno">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-3">
                        <div class="form-group">
                            <label for="">MM</label>
                            <input type="number" class="form-control" id="expmnt">
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="form-group">
                            <label for="YY">YY</label>
                            <input type="number" class="form-control" id="expyear">
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="form-group">
                            <label for="">CVV</label>
                            <input type="number" class="form-control" id="cvv">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="form-group">
                            <label for="">Card Holder Name</label>
                            <input type="text" class="form-control" id="cardname">
                        </div>
                    </div>
                </div>
                <button class="btn btn-success btn-block shadow" id="payFlex">PAY</button>
                <p id="resp"></p>
            </div>
        </div>
        <a href="index.html" class="btn btn-lg btn-default text-white btn-block btn-rounded shadow"><span>Shop</span><i class="material-icons">arrow_back</i></a>

    </div>
    </div>
    </div>

    <!-- jquery, popper and bootstrap js -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="vendor/bootstrap-4.3.1/js/bootstrap.min.js"></script>

    <!-- swiper js -->
    <script src="vendor/swiper/js/swiper.min.js"></script>

    <!-- template custom js -->
    <script src="https://kit.fontawesome.com/71ba3dee2b.js" crossorigin="anonymous"></script>
    <script src="https://checkout.flutterwave.com/v3.js"></script>
    <script src="js/main.js"></script>
    <script src="js/profile.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script src="checkout.js"></script>
    <script>
        document.getElementById("email").value = email;
        document.getElementById("token").value = token;
        $.ajax({
            url: "https://evolve.capfields.com.ng/user_app/flex.php",
            type: "POST",
            headers: {
                Accept: 'application/json'
            },
            data: {
                email: email,
                token: token
            },
            success: function(res) {
                console.log(res)
                msg = res.message;
                if (msg == 'success') {
                    name = res.name;
                    $("#flexname").append(name);
                    salary = res.salary;
                    $("#salary").append('N', salary);
                    allowance = res.allowance;
                    $("#allowance").append('N', allowance);
                    used = res.used;
                    $("#repay").append('N', res.repay);
                    $("#repaydate").append(res.repaydate);
                    document.getElementById("amountused").value = res.repay;
                    document.getElementById("tamt").value = res.repay;
                    document.getElementById("amounttransfer").value = res.repay;
                    $("#used").append('N', used);
                    balance = res.balance;
                    $("#flexbal").append('N', balance)

                } else if (msg == 'false') {
                    alert('Apply for flex');
                    window.location = 'flex-application.html';
                } else if (msg == 'pending') {
                    alert('Your flex application awaits admin approval');
                    location.href = 'index.html';
                } else {
                    alert('Error loading..');
                }
            },
            error: function(res) {
                console.log(res)
                alert('Error in connection')
            }
        });

        function checkAmt() {
            amount = $("#amountused").val();
            if (amount == "") {
                alert('Error');
            } else if (amount == 0) {
                alert('Your payment cannot be proccessed');
            } else {
                $("#cardpayment").removeClass("hidden");
            }
        }

        function showStack() {
            $(".paystack").toggleClass("hidden");
        }

        function showtransfer() {
            $(".normal").addClass("hidden");
            $(".transfer").removeClass("hidden");
        }

        $(document).ready(function(e) {
            $("#uploadimage").on('submit', (function(e) {
                document.getElementById("uploadBtn").innerHTML = '<i class="fa fa-circle-o-notch fa-spin" style="font-size:25px"></i>';
                e.preventDefault();
                $.ajax({
                    url: "https://evolve.capfields.com.ng/user_app/uploadflex.php", // Url to which the request is send
                    type: "POST", // Type of request to be send, called as method
                    data: new FormData(this), // Data sent to server, a set of key/value pairs (i.e. form fields and values)
                    contentType: false, // The content type used when sending data to the server.
                    cache: false, // To unable request pages to be cached
                    processData: false, // To send DOMDocument or non processed data file it is set to false
                    success: function(data) // A function to be called if request succeeds
                        {
                            console.log(data)
                            msg = data.message;
                            if (msg == 'success') {
                                alert('Payment proof uploaded successfully');
                                document.getElementById("uploadBtn").innerHTML = 'Submit';
                                location.href = 'index.html';
                            } else {
                                alert(msg);
                                document.getElementById("uploadBtn").innerHTML = 'Submit';
                            }
                        },
                    error: function(data) {
                        console.log(data)
                        alert('Error in connection')
                        document.getElementById("uploadBtn").innerHTML = 'Submit';
                    }
                });
            }));
        });

        function makePayment() {
            inputamount = $("#amountused").val();
            if (inputamount == "") {
                alert('Error');
            } else if (inputamount == 0) {
                alert('Your payment cannot be proccessed');
            } else {
                FlutterwaveCheckout({
                    public_key: "FLWPUBK-f129a6e0a499714b8d4cc9eb618fc994-X",
                    tx_ref: token,
                    amount: inputamount,
                    currency: "NGN",
                    country: "NG",
                    payment_options: "card",
                    customer: {
                        email: email,
                        phone_number: localStorage.getItem("phone"),
                        name: localStorage.getItem("custName"),
                    },
                    callback: function(data) { // specified callback function
                        console.log(data);
                        status = data.status;
                        if (status == 'successful') {
                            $.ajax({
                                url: "https://evolve.capfields.com.ng/user_app/repayflex.php",
                                type: "POST",
                                headers: {
                                    Accept: 'application/json'
                                },
                                data: {
                                    email: email,
                                    token: token,
                                    amount: inputamount,
                                    reference: data.flw_ref
                                },
                                success: function(res) {
                                    console.log(res)
                                    msg = res.message;
                                    if (msg == 'success') {
                                        window.location = 'flex-dashboard.html';
                                    } else {
                                        alert(msg);
                                    }
                                },
                                error: function(res) {
                                    console.log(res)
                                    alert('Error occurred. Transaction reference: ' + data.flw_ref);
                                }
                            })
                        }
                    },
                    customizations: {
                        title: "Capfields Evolve",
                        description: "Flex Repayment",
                        logo: "https://evolve.capfields.com.ng/user_app/img/logo.png",
                    },
                });
            }
        }

        function payWithPaystack() {
            inputamount = $("#amountused").val();
            if (inputamount == "") {
                alert('Error');
            } else if (inputamount == 0) {
                alert('Your payment cannot be proccessed');
            } else {
                amount = inputamount * 100;
                var handler = PaystackPop.setup({
                    key: 'pk_live_73bea53857da2959a95f98f6e41c070115bb74f2',
                    email: email,
                    amount: amount,
                    currency: "NGN",
                    ref: '' + Math.floor((Math.random() * 1000000000) + 1), // generates a pseudo-unique reference. Please replace with a reference you generated. Or remove the line entirely so our API will generate one for you
                    metadata: {
                        custom_fields: [{
                            display_name: "Mobile Number",
                            variable_name: "mobile_number",
                            value: "+2348012345678"
                        }]
                    },
                    callback: function(response) {
                        alert('success. transaction ref is ' + response.reference);
                        $.ajax({
                            url: "https://evolve.capfields.com.ng/user_app/repayflex.php",
                            type: "POST",
                            headers: {
                                Accept: 'application/json'
                            },
                            data: {
                                email: email,
                                token: token,
                                amount: inputamount,
                                reference: response.reference
                            },
                            success: function(res) {
                                console.log(res)
                                msg = res.message;
                                if (msg == 'success') {
                                    window.location = 'flex-dashboard.html';
                                } else {
                                    alert(msg);
                                }
                            },
                            error: function(res) {
                                console.log(res)
                                alert('Error occurred. Transaction reference: ' + response.reference);
                            }
                        })
                    },
                    onClose: function() {
                        alert('window closed');
                    }
                });
                handler.openIframe();
            }
        }

        //check flex status
        /*$.ajax({
            url: "https://evolve.capfields.com.ng/user_app/check-flex.php",
            type: "POST",
            headers: {
                Accept: 'application/json'
            },
            data: {
                email: email,
                token: token
            },
            success: function(res) {
                console.log(res)
            },
            error: function(res) {
                console.log(res);
            }
        });*/
    </script>
</body>

</html>